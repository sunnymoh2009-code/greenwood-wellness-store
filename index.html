<script>
  // ---------- Affiliate tags ----------
  const AFFILIATE_TAG_US = "greenwoodinvestments-20";
  const AFFILIATE_TAG_CA = "greenwoodin01-20";

  // ---------- Region detection (simple & private) ----------
  const isCA =
    (navigator.language || "").toLowerCase().includes("en-ca") ||
    (Intl.DateTimeFormat().resolvedOptions().timeZone || "").includes("America/Edmonton") ||
    location.hostname.endsWith(".ca");

  // ---------- Helpers ----------
  const ph = (name) => `https://dummyimage.com/600x400/edf2f7/1f2937&text=${encodeURIComponent(name)}`;

  // Product page URL (deep link or tagged search fallback)
  function buyUrl(p) {
    const q = encodeURIComponent(p.title);
    if (isCA) {
      if (p.asinCA) return `https://www.amazon.ca/dp/${p.asinCA}?tag=${encodeURIComponent(AFFILIATE_TAG_CA)}`;
      return `https://www.amazon.ca/s?k=${q}&tag=${encodeURIComponent(AFFILIATE_TAG_CA)}`;
    }
    if (p.asinUS) return `https://www.amazon.com/dp/${p.asinUS}?tag=${encodeURIComponent(AFFILIATE_TAG_US)}`;
    return `https://www.amazon.com/s?k=${q}&tag=${encodeURIComponent(AFFILIATE_TAG_US)}`;
  }

  // Smart Add-to-Cart:
  // Uses Amazon's cart add endpoint when we have a region-appropriate ASIN.
  // Falls back to the product page if not available (so nothing breaks).
  function addToCartUrl(p, qty = 1) {
    if (isCA && p.asinCA) {
      return `https://www.amazon.ca/gp/aws/cart/add.html?ASIN.1=${encodeURIComponent(p.asinCA)}&Quantity.1=${qty}&tag=${encodeURIComponent(AFFILIATE_TAG_CA)}`;
    }
    if (!isCA && p.asinUS) {
      return `https://www.amazon.com/gp/aws/cart/add.html?ASIN.1=${encodeURIComponent(p.asinUS)}&Quantity.1=${qty}&tag=${encodeURIComponent(AFFILIATE_TAG_US)}`;
    }
    // Fallback: open normal product page for the detected region
    return buyUrl(p);
  }

  function productCard(p) {
    const li = document.createElement("div");
    li.className = "group relative flex flex-col justify-between rounded-2xl border bg-white p-4 shadow-sm transition hover:shadow-md";
    li.innerHTML = `
      <div class="imgwrap">
        <img src="${p.image || ph(p.title)}" alt="${p.title}" loading="lazy" width="600" height="400" />
      </div>
      <div class="mt-3 flex items-start justify-between gap-3">
        <div>
          <h3 class="text-base font-semibold leading-tight">${p.title}</h3>
          <p class="text-sm text-gray-600">${p.subtitle || ""}</p>
        </div>
        ${p.badge ? `<span class="shrink-0 rounded-full border px-2 py-0.5 text-xs font-medium">⭐ ${p.badge}</span>` : ``}
      </div>
      <ul class="mt-3 space-y-1 text-sm text-gray-700">
        ${(p.bullets||[]).map(b => `<li class="flex items-start gap-2"><span class="dot"></span><span>${b}</span></li>`).join("")}
      </ul>
      <div class="mt-4 flex items-center justify-between gap-3">
        <a href="${addToCartUrl(p)}" target="_blank" rel="nofollow sponsored noopener"
           class="inline-flex items-center gap-2 rounded-xl bg-emerald-600 px-3 py-2 text-sm font-semibold text-white transition hover:-translate-y-px hover:bg-emerald-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M6 6h15l-1.5 9h-12z"/><circle cx="9" cy="20" r="1.5"/><circle cx="18" cy="20" r="1.5"/>
          </svg>
          Add to Cart
        </a>
        <a href="${buyUrl(p)}" target="_blank" rel="nofollow sponsored noopener"
           class="inline-flex items-center gap-2 rounded-xl border px-3 py-2 text-sm font-semibold text-gray-900 transition hover:-translate-y-px">
          View
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M7 7h10v10"/><path d="M7 17 17 7"/>
          </svg>
        </a>
      </div>
    `;
    return li;
  }

  function render(list, title, desc) {
    sectionTitle.textContent = title;
    sectionDesc.textContent = desc;
    grid.innerHTML = "";
    list.forEach(p => grid.appendChild(productCard(p)));
  }

  // ---------- Catalogs (reuse your existing arrays) ----------
  // Keep your existing arrays exactly as you have them now:
  // joyspring, healthBeauty, vitaminsSupp, fitness, babyKids, mensGroom
  // (If they’re already declared above this script in your file, remove duplicates.
  //  If they’re in this same block, leave as-is.)

  // If these arrays are already in your file from the previous version, DO NOT redefine them.
  // Otherwise paste the arrays here (unchanged from your working version).

  // ---------- Wire up tabs ----------
  const grid = document.getElementById("grid");
  const sectionTitle = document.getElementById("sectionTitle");
  const sectionDesc = document.getElementById("sectionDesc");

  const tabJoy = document.getElementById("tab-joyspring");
  const tabHB = document.getElementById("tab-hb");
  const tabVit = document.getElementById("tab-vitamins");
  const tabFit = document.getElementById("tab-fitness");
  const tabBaby = document.getElementById("tab-baby");
  const tabMen = document.getElementById("tab-men");

  function setActive(btn) {
    [tabJoy, tabHB, tabVit, tabFit, tabBaby, tabMen].forEach(b => b && delete b.dataset.active);
    if (btn) btn.dataset.active = "true";
  }

  // Attach only if those buttons exist on the page
  if (tabJoy) tabJoy.addEventListener("click", () => {
    setActive(tabJoy);
    render(joyspring, "Featured JoySpring Products", "Carefully curated best-sellers you can recommend with confidence.");
    const shop = document.getElementById("shopLingo");
    if (shop && joyspring[0]) shop.href = buyUrl(joyspring[0]);
  });

  if (tabHB) tabHB.addEventListener("click", () => {
    setActive(tabHB);
    render(healthBeauty, "Top Health & Beauty Best-Sellers", "Highly-rated essentials added for your convenience.");
  });

  if (tabVit) tabVit.addEventListener("click", () => {
    setActive(tabVit);
    render(vitaminsSupp, "Vitamins & Supplements", "Everyday wellness staples customers love.");
  });

  if (tabFit) tabFit.addEventListener("click", () => {
    setActive(tabFit);
    render(fitness, "Fitness & Weight Loss", "Popular picks for training, recovery, and hydration.");
  });

  if (tabBaby) tabBaby.addEventListener("click", () => {
    setActive(tabBaby);
    render(babyKids, "Baby & Kids Wellness", "Parent-approved favorites for little ones.");
  });

  if (tabMen) tabMen.addEventListener("click", () => {
    setActive(tabMen);
    render(mensGroom, "Men’s Grooming Essentials", "Clean, simple, effective daily care.");
  });

  // Initial load (default to JoySpring)
  setActive(tabJoy || null);
  if (typeof joyspring !== "undefined") {
    render(joyspring, "Featured JoySpring Products", "Carefully curated best-sellers you can recommend with confidence.");
    const shop = document.getElementById("shopLingo");
    if (shop && joyspring[0]) shop.href = buyUrl(joyspring[0]);
  }
</script>
