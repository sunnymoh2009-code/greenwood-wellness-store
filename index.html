<script>
  // ---------- CONFIG ----------
  const AFFILIATE_TAG_US = "greenwoodinvestments-20";
  const AFFILIATE_TAG_CA = "greenwoodin01-20";
  const IMG_BASE = "/greenwood-wellness-store/images"; // GitHub Pages repo path + /images
  const PLACEHOLDER = "placeholder.jpg";

  // Region detection (.ca vs .com)
  const isCA =
    (navigator.language || "").toLowerCase().includes("en-ca") ||
    (Intl.DateTimeFormat().resolvedOptions().timeZone || "").includes("America/Edmonton") ||
    location.hostname.endsWith(".ca");

  const amazonLink = (asinUS, asinCA, title) => {
    if (isCA) {
      if (asinCA) return `https://www.amazon.ca/dp/${asinCA}?tag=${encodeURIComponent(AFFILIATE_TAG_CA)}`;
      return `https://www.amazon.ca/s?k=${encodeURIComponent(title)}&tag=${encodeURIComponent(AFFILIATE_TAG_CA)}`;
    }
    return `https://www.amazon.com/dp/${asinUS}?tag=${encodeURIComponent(AFFILIATE_TAG_US)}`;
  };

  const imgUrl = (fileName) => `${IMG_BASE}/${fileName || PLACEHOLDER}`;

  // ---------- DATA ----------
  // JoySpring (existing section on your page)
  const productsJoySpring = [
    { title: "Lingo Leap", subtitle: "Speech & Communication Support Drops", asinUS: "B0D2F9CZR5", asinCA: "B0F47D7K8H", bullets: ["Zeolite + D3 + B12","Language development","Kid-friendly drops"], badge: "Flagship", rating: 4.7, img: "lingo-leap.jpg" },
    { title: "Genius Drops (1 oz)", subtitle: "Clinically-Proven Focus Support", asinUS: "B075FH1P4Y", asinCA: null, bullets: ["Ginkgo blend","Focus & attention","30 servings"], rating: 4.5, img: "genius-drops-1oz.jpg" },
    { title: "Genius Drops (4 oz)", subtitle: "Family Size Focus Support", asinUS: "B07J6RFL35", asinCA: null, bullets: ["Herbal nootropics","120 servings"], rating: 4.6, img: "genius-drops-4oz.jpg" },
    { title: "Vitamin D3 Gummies for Kids", subtitle: "D3 + K2 ‚Äì Growth & Development", asinUS: "B0C87JFLDN", asinCA: null, bullets: ["60 gummies","Kids & teens","Bone & immunity"], rating: 4.6, img: "vitamin-d3-gummies-kids.jpg" },
    { title: "Immune Drops", subtitle: "Elderberry + Echinacea + Oregon Grape Root", asinUS: "B078WK3Q4K", asinCA: null, bullets: ["Sugar-free","Herbal immunity"], rating: 4.5, img: "immune-drops.jpg" },
    { title: "Zeolite Drops for Kids", subtitle: "Natural Zeolite + Vitamin D3", asinUS: "B0D2BKRDD7", asinCA: null, bullets: ["Daily wellness","Zero-chemical zeolite"], rating: 4.4, img: "zeolite-drops-kids.jpg" },
    { title: "Kids B-Complex", subtitle: "B Vitamins + Elderberry + Zinc + C", asinUS: "B0B18RX61R", asinCA: null, bullets: ["Overall wellness","Amazon's Choice"], rating: 4.6, img: "kids-b-complex.jpg" },
    { title: "School Backup Support Bundle", subtitle: "Immune wellness kit for kids & teens", asinUS: "B0D9PHYCWF", asinCA: null, bullets: ["Non-GMO","USA-made","Bundle savings"], rating: 4.6, img: "school-backup-bundle.jpg" }
  ];

  // Health & Beauty (your new grid)
  const productsHealthBeauty = [
    { title: "Mighty Patch Original (36 ct)", subtitle: "Hydrocolloid Acne Pimple Patches", asinUS: "B07GZ1ZB7T", asinCA: "B0B3T2VBLH", bullets: ["Overnight results","Protects & heals"], badge: "Best Seller", rating: 4.7, img: "mighty-patch-original.jpg" },
    { title: "Neutrogena Makeup Remover Wipes", subtitle: "Cleansing Towelettes", asinUS: "B00U2VQZDS", asinCA: "B07S8CB7X6", bullets: ["Removes waterproof","Soft on skin"], rating: 4.7, img: "neutrogena-makeup-wipes.jpg" },
    { title: "e.l.f. Lash & Brow Enhancing Serum", subtitle: "Condition & boost look", asinUS: "B0B4PX5Y9B", asinCA: "B0B4PX5Y9B", bullets: ["Peptides + vitamins","Clear, gentle"], rating: 4.4, img: "elf-lash-brow-serum.jpg" },
    { title: "LANEIGE Lip Sleeping Mask", subtitle: "Overnight lip care", asinUS: "B07P8QG2F8", asinCA: "B07P8QG2F8", bullets: ["Ultra-moisturizing","Cult-favorite"], badge: "Amazon‚Äôs Choice", rating: 4.7, img: "laneige-lip-sleeping-mask.jpg" },
    { title: "Mielle Rosemary Mint Oil", subtitle: "Scalp & Hair Strengthening Oil", asinUS: "B07VYPYT1S", asinCA: "B0C5ST1ML4", bullets: ["Biotin infused","For all hair types"], rating: 4.6, img: "mielle-rosemary-mint-oil.jpg" },
    { title: "CeraVe Eye Repair Cream", subtitle: "Hyaluronic Acid & Ceramides", asinUS: "B00JJPMXDO", asinCA: "B00JJPMXDO", bullets: ["Derm-developed","Fragrance-free"], rating: 4.6, img: "cerave-eye-repair-cream.jpg" },
    { title: "Sol de Janeiro Brazilian Crush ‚Äô62", subtitle: "Body Fragrance Mist", asinUS: "B07DK4YHYF", asinCA: "B07DK4YHYF", bullets: ["Pistachio & caramel","Iconic scent"], rating: 4.7, img: "sol-de-janeiro-62.jpg" },
    { title: "Paula‚Äôs Choice 2% BHA Liquid", subtitle: "Salicylic Acid Exfoliant", asinUS: "B00949CTQQ", asinCA: "B09BBQ6Z4H", bullets: ["Unclogs pores","Smoother skin"], rating: 4.6, img: "paulas-choice-bha-2.jpg" },
    { title: "Good Molecules Gentle Retinol Cream", subtitle: "Beginner-friendly retinol", asinUS: "B0B5D6R9LL", asinCA: "B0B5D6R9LL", bullets: ["Encapsulated retinol","Soothing base"], rating: 4.4, img: "good-molecules-retinol.jpg" },
    { title: "Olay Anti-Wrinkle 2-in-1 Day Cream + Serum", subtitle: "Age Defying, 50 mL", asinUS: "B0060MDP0G", asinCA: "B00HYGJHPA", bullets: ["Niacinamide + aloe","Lightweight daily"], rating: 4.5, img: "olay-anti-wrinkle-2in1.jpg" }
  ];

  // ---------- RENDER ----------
  const starSvg = (filled) => `
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ${filled ? '' : 'opacity-30'}" viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 .587l3.668 7.431 8.2 1.193-5.934 5.787 1.402 8.168L12 18.897 4.664 23.166l1.402-8.168L.132 9.211l8.2-1.193z"/>
    </svg>`;

  function ratingStars(r) {
    const full = Math.floor(r || 0);
    const stars = Array.from({length:5}, (_,i)=> starSvg(i<full));
    return `<div class="pointer-events-none absolute left-2 top-2 inline-flex items-center gap-1 rounded-full bg-black/70 px-2 py-1 text-xs font-medium text-white">${stars.join("")}<span class="ml-1">${(r || 0).toFixed(1)}</span></div>`;
  }

  function productCard(p) {
    const href = amazonLink(p.asinUS, p.asinCA, p.title);
    return `
      <div class="group relative overflow-hidden rounded-2xl border bg-white shadow-sm transition hover:shadow-md">
        <div class="relative aspect-square w-full bg-gray-100">
          <img src="${imgUrl(p.img)}" alt="${p.title}" class="h-full w-full object-cover"/>
          ${p.rating ? ratingStars(p.rating) : ""}
          ${p.badge ? `<div class="absolute right-2 top-2 rounded-full bg-amber-100 px-2 py-1 text-xs font-semibold text-amber-700">‚≠ê ${p.badge}</div>` : ""}
        </div>
        <div class="p-4">
          <h3 class="text-base font-semibold leading-tight">${p.title}</h3>
          <p class="text-sm text-gray-600">${p.subtitle || ""}</p>
          ${p.bullets?.length ? `
            <ul class="mt-3 space-y-1 text-sm text-gray-700">
              ${p.bullets.map(b => `<li class="flex items-start gap-2"><span class="dot"></span><span>${b}</span></li>`).join("")}
            </ul>` : ""}
          <div class="mt-4 flex flex-wrap items-center justify-between gap-2">
            <a href="${href}" target="_blank" rel="nofollow sponsored noopener"
               class="inline-flex items-center gap-2 rounded-xl bg-emerald-600 px-3 py-2 text-sm font-semibold text-white transition hover:-translate-y-px hover:bg-emerald-700">
              üõí Get Fast Amazon Delivery
            </a>
            <div class="flex items-center gap-3 text-xs text-gray-600">
              <span>‚úÖ Prime Available</span>
              <span>üîí Secure Checkout</span>
            </div>
          </div>
        </div>
      </div>
    `;
  }

  // Insert cards into existing grids
  const gridJoyspring = document.getElementById("grid") || document.querySelector("#grid"); // your existing JoySpring grid
  if (gridJoyspring) {
    gridJoyspring.innerHTML = "";
    productsJoySpring.forEach(p => gridJoyspring.insertAdjacentHTML("beforeend", productCard(p)));
    // Top CTA button (Shop Lingo)
    const lingo = productsJoySpring[0];
    const shopBtn = document.getElementById("shopLingo");
    if (shopBtn) shopBtn.href = amazonLink(lingo.asinUS, lingo.asinCA, lingo.title);
  }

  // Health & Beauty grid (create or fill)
  let gridHB = document.getElementById("grid-hb");
  if (!gridHB) {
    const hbSection = document.createElement("section");
    hbSection.className = "mx-auto max-w-6xl px-4 py-10";
    hbSection.innerHTML = `
      <h2 class="text-2xl font-bold">Top Health & Beauty Best-Sellers</h2>
      <p class="mt-1 text-gray-600">Highly-rated essentials added for your convenience.</p>
      <div id="grid-hb" class="mt-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>
    `;
    document.querySelector("main")?.appendChild(hbSection);
    gridHB = hbSection.querySelector("#grid-hb");
  }
  gridHB.innerHTML = "";
  productsHealthBeauty.forEach(p => gridHB.insertAdjacentHTML("beforeend", productCard(p)));
</script>
